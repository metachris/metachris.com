<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Chris Hager"><meta name=description content="TypeScript 2.1 introduced a number of breaking changes, among them that &ldquo;Extending built-ins like Error, Array, and Map may no longer work&rdquo;.
For a subclass like the following:
class FooError extends Error { constructor(m: string) { super(m); } sayHello() { return &#34;hello &#34; + this.message; } }   methods may be undefined on objects returned by constructing these subclasses, so calling sayHello will result in an error. instanceof will be broken between instances of the subclass and their instances, so (new FooError()) instanceof FooError will return false."><meta name=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.metachris.com/images/profile2-round.png"><meta name=twitter:title content="Custom Errors in TypeScript 2.1"><meta name=twitter:description content="TypeScript 2.1 introduced a number of breaking changes, among them that &ldquo;Extending built-ins like Error, Array, and Map may no longer work&rdquo;.
For a subclass like the following:
class FooError extends Error { constructor(m: string) { super(m); } sayHello() { return &#34;hello &#34; + this.message; } }   methods may be undefined on objects returned by constructing these subclasses, so calling sayHello will result in an error. instanceof will be broken between instances of the subclass and their instances, so (new FooError()) instanceof FooError will return false."><meta property="og:title" content="Custom Errors in TypeScript 2.1"><meta property="og:description" content="TypeScript 2.1 introduced a number of breaking changes, among them that &ldquo;Extending built-ins like Error, Array, and Map may no longer work&rdquo;.
For a subclass like the following:
class FooError extends Error { constructor(m: string) { super(m); } sayHello() { return &#34;hello &#34; + this.message; } }   methods may be undefined on objects returned by constructing these subclasses, so calling sayHello will result in an error. instanceof will be broken between instances of the subclass and their instances, so (new FooError()) instanceof FooError will return false."><meta property="og:type" content="article"><meta property="og:url" content="https://www.metachris.com/2017/01/custom-errors-in-typescript-2.1/"><meta property="og:image" content="https://www.metachris.com/images/profile2-round.png"><meta property="article:published_time" content="2017-01-06T00:00:00+00:00"><meta property="article:modified_time" content="2017-01-06T00:00:00+00:00"><base href=https://www.metachris.com/2017/01/custom-errors-in-typescript-2.1/><title>Custom Errors in TypeScript 2.1 · Chris Hager</title><link rel=canonical href=https://www.metachris.com/2017/01/custom-errors-in-typescript-2.1/><link rel=stylesheet href=https://www.metachris.com/css/normalize.min.css><link rel=stylesheet href=https://www.metachris.com/css/coder.min.289c3973f873a44b2356dd2eeae46bdf6eb9576973b762fb71fe125918485af4.css integrity="sha256-KJw5c/hzpEsjVt0u6uRr3265V2lzt2L7cf4SWRhIWvQ=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://www.metachris.com/css/coder-dark.min.5d88e189a7c453021544d4cd4bed96166f53dd106dddf20093d615ebe92a32e5.css integrity="sha256-XYjhiafEUwIVRNTNS+2WFm9T3RBt3fIAk9YV6+kqMuU=" crossorigin=anonymous media=screen><script src=https://www.metachris.com/js/custom.js></script><link rel=stylesheet href=https://www.metachris.com/scss/custom.min.2d51f24054c8ca6e686cd5937a3ee365bd34c6366e5b26f0e556d2c032b82be0.css integrity="sha256-LVHyQFTIym5obNWTej7jZb00xjZuWybw5VbSwDK4K+A=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://www.metachris.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.metachris.com/images/favicon-16x16.png sizes=16x16><link rel=alternate type=application/rss+xml href=https://www.metachris.comindex.xml title="Site Title"></head><body class=colorscheme-auto><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.metachris.com/>Chris Hager</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.metachris.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://www.metachris.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://www.metachris.com/projects/>Projects</a></li><li class=navigation-item><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw"></i></a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Custom Errors in TypeScript 2.1</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2017-01-06T00:00:00Z>January 6, 2017</time></span>
<span class=reading-time><i class="fas fa-clock"></i>2 minutes read</span></div><div class=tags><i class="fas fa-tag"></i><a href=https://www.metachris.com/tags/node.js/>Node.js</a>
<span class=separator>•</span>
<a href=https://www.metachris.com/tags/typescript/>TypeScript</a>
<span class=separator>•</span>
<a href=https://www.metachris.com/tags/javascript/>JavaScript</a></div></div></header><div><p>TypeScript 2.1 introduced a number of <a href=https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md>breaking changes</a>,
among them that &ldquo;<b><a href=https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work>Extending built-ins like Error, Array, and Map may no longer work</a></b>&rdquo;.</p><p><img src=https://www.metachris.com/images/posts/typescript-fire.jpg></p><p>For a subclass like the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FooError</span> <span style=color:#66d9ef>extends</span> Error {
    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>m</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
        <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>m</span>);
    }
    <span style=color:#a6e22e>sayHello</span>() {
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span>;
    }
}
</code></pre></div><ul><li>methods may be undefined on objects returned by constructing these subclasses, so calling sayHello will result in an error.</li><li><code>instanceof</code> will be broken between instances of the subclass and their instances, so (<code>new FooError()) instanceof FooError</code> will return <code>false</code>.</li></ul><p>The suggested solution of manually adjusting the prototype with <code>Object.setPrototypeOf(this, FooError.prototype)</code> might not work
due to <code>Object.setPrototypeOf(..)</code> being missing.</p><h2 id=the-solution>The Solution</h2><p>After trying several approaches, the solution <a href=https://gist.github.com/justmoon/15511f92e5216fa2624b>presented here</a> seems to be the way which reliably works,
including with promises (native and bluebird):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>util</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;util&#34;</span>;

<span style=color:#75715e>// Custom Error 1
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CustomError1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>message</span>) {
    Error.<span style=color:#a6e22e>captureStackTrace</span>(<span style=color:#66d9ef>this</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>constructor</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>name</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>message</span>;
};
<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>inherits</span>(<span style=color:#a6e22e>CustomError1</span>, Error);

<span style=color:#75715e>// Custom Error 2
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CustomError2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>message</span>) {
    Error.<span style=color:#a6e22e>captureStackTrace</span>(<span style=color:#66d9ef>this</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>constructor</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>name</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>message</span>;
};
<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>inherits</span>(<span style=color:#a6e22e>CustomError2</span>, Error);

<span style=color:#75715e>// Tests
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>e</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CustomError1</span>(<span style=color:#e6db74>&#34;Foo&#34;</span>);
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;instanceof error: &#34;</span>, <span style=color:#a6e22e>e</span> <span style=color:#66d9ef>instanceof</span> Error);  <span style=color:#75715e>// true
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;instanceof own class: &#34;</span>, <span style=color:#a6e22e>e</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>CustomError1</span>);  <span style=color:#75715e>// true
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;instanceof other error class: &#34;</span>, <span style=color:#a6e22e>e</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>CustomError2</span>);  <span style=color:#75715e>// false
</span></code></pre></div><hr class=spaced><p>If you have suggestions or feedback, let me know via <a href=https://twitter.com/@metachris>@metachris</a>.</p></div><footer><script src=https://utteranc.es/client.js repo=metachris/metachris.com-comments issue-term=og:title theme=preferred-color-scheme crossorigin=anonymous async></script></footer></article></section></div><footer class=footer><section class=container></section></footer></main><script src=https://www.metachris.com/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-168016633-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-168016633-1');</script><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.11.2/css/all.css integrity=sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN crossorigin=anonymous></body></html>